# インラインコピー機能（見出し参照対応版）タスクリスト

## ストーリー概要

ユーザーがVSCodeのExplorer上でファイルを右クリックした際のコンテキストメニューから「Inlined Copy」を選択すると、ドキュメント内の`![[ファイル名#見出し名]]`形式のリンクを展開してコピーできるようにする機能を実装する。見出しレベルやネスト構造に対応し、カスタム設定も可能にすることで、文書間の参照が容易になりナレッジベースの利便性が向上する。

## タスク一覧表

| タスクID | タイトル | 見積時間(時間) | 依存タスク |
| -------- | --------------- | -------------- | ---------- |
| TASK-002 | 単一見出し検出・抽出機能の実装 | 8 | なし |
| TASK-003 | ネスト見出し・サブ見出し処理の実装 | 6 | TASK-002 |
| TASK-004 | 見出しID記法（`{#custom-id}`）対応 | 5 | TASK-002 |
| TASK-005 | ファイル参照・読み込み共通処理の統合 | 6 | TASK-003, TASK-004 |
| TASK-006 | 存在しない参照の例外処理・通知機能実装 | 4 | TASK-005 |
| TASK-007 | コンテキストメニュー拡張実装 | 5 | TASK-005 |
| TASK-008 | 設定項目の追加と管理機能実装 | 6 | TASK-005 |
| TASK-009 | 単体テスト開発 | 8 | TASK-006, TASK-007, TASK-008 |
| TASK-010 | 統合テストの実施 | 9 | TASK-009 |
| TASK-011 | ドキュメント作成とリリース準備 | 6 | TASK-010 |

## 実行順序と依存関係

1. TASK-002 → (TASK-003, TASK-004) → TASK-005 → (TASK-006, TASK-007, TASK-008) → TASK-009 → TASK-010 → TASK-011

※ TASK-003とTASK-004は並行実行可能
※ TASK-006、TASK-007、TASK-008は並行実行可能

## 詳細タスク内容

### TASK-002: 単一見出し検出・抽出機能の実装（推定：8時間）

- **概要**: `![[ファイル名#見出し名]]`パターンを検出し、指定された見出しセクションを抽出する機能を実装
- **成果物**: 
  - 見出し検出用の正規表現モジュール
  - Markdown見出しレベル(h1-h7)識別機能
  - セクション抽出ロジック
- **参照ドキュメント**: 
  - Markdown仕様書
  - 補足情報（見出し対応仕様）
- **前提条件**: 
  - 既存のVer1実装を理解していること
- **完了条件**: 
  - `#`で指定した見出しを正確に検出できる（h1-h7）
  - ファイル先頭から検索し最初にヒットした見出しを展開できる
  - 見出し行から次の同レベル以上の見出しまでの内容を抽出できる
- **注意点**: 
  - 見出し形式のバリエーション対応
  - 同名見出しの扱い（先頭のものを採用）

### TASK-003: ネスト見出し・サブ見出し処理の実装（推定：6時間）

- **概要**: `![[ファイル名#親見出し#子見出し]]`形式のネスト構造を解析し、親見出し内の子見出しセクションを抽出する
- **成果物**: 
  - 複数レベルの見出しパス解析ロジック
  - ネスト構造に基づく階層的セクション抽出機能
- **参照ドキュメント**: 
  - 補足情報（見出し対応仕様のサブ見出し部分）
- **前提条件**: 
  - TASK-002が完了していること
- **完了条件**: 
  - `#見出し名#サブ見出し名`形式の指定を解析できる
  - 親見出し内の指定されたサブ見出しセクションのみを抽出できる
- **注意点**: 
  - 見出しのネスト解析で親見出しセクション範囲外の同名見出しを誤検出しないこと
  - 複雑なネスト構造にも対応できる堅牢な実装

### TASK-004: 見出しID記法（`{#custom-id}`）対応（推定：5時間）

- **概要**: Markdownの見出しID記法（`## 見出し {#custom-id}`）に対応し、IDによる見出し参照を可能にする
- **成果物**: 
  - 見出しID検出機能
  - ID参照によるセクション抽出機能
- **参照ドキュメント**: 
  - 拡張Markdown構文仕様（見出しID記法）
- **前提条件**: 
  - TASK-002が完了していること
- **完了条件**: 
  - `![[ファイル名#custom-id]]`形式の参照でIDを持つ見出しセクションを抽出できる
  - 見出しテキストとIDの両方で検索できる
- **注意点**: 
  - 様々なMarkdownプロセッサーにおけるID記法の違いに対応
  - テキスト検索とID検索の優先順位の明確化

### TASK-005: ファイル参照・読み込み共通処理の統合（推定：6時間）

- **概要**: 既存のファイル解決機能と新しい見出し抽出機能を統合し、全体的なフローを完成させる
- **成果物**: 
  - 統合されたファイル読み込み・見出し抽出モジュール
  - 各種パターンに対応した処理フロー
- **参照ドキュメント**: 
  - VS Codeファイルシステム関連API
  - README.md（プロジェクト基本情報）
- **前提条件**: 
  - TASK-003とTASK-004が完了していること
- **完了条件**: 
  - ファイルパスが正しく解決され、内容が読み込める
  - 様々なリンク形式（単一見出し、ネスト見出し、ID参照）に対応した統合処理が機能する
- **注意点**: 
  - 既存機能との共通部分の重複を避け、再利用を最大化
  - ファイル読み込みのパフォーマンスと大きなファイルへの対応

### TASK-006: 存在しない参照の例外処理・通知機能実装（推定：4時間）

- **概要**: 参照先ファイルや見出しが存在しない場合の例外処理と通知機能を実装
- **成果物**: 
  - エラーハンドリングモジュール
  - トースト通知システム
- **参照ドキュメント**: 
  - VS Code通知API仕様
  - 補足情報（参照先の存在チェック仕様）
- **前提条件**: 
  - TASK-005が完了していること
- **完了条件**: 
  - 存在しない参照は`![[ファイル名#見出し名]]`が残ったままになる（展開されない）
  - エラー内容がトーストで適切に通知される
- **注意点**: 
  - 複数エラー発生時のUX考慮
  - エラーメッセージの明確さと情報提供バランス

### TASK-007: コンテキストメニュー拡張実装（推定：5時間）

- **概要**: Explorer上でファイルを右クリック時のコンテキストメニューに「Inlined Copy」オプションを追加
- **成果物**: 
  - Explorer向けコンテキストメニュー定義
  - メニュー選択時の処理実装
- **参照ドキュメント**: 
  - VS Codeメニュー拡張API仕様
  - 補足情報（コンテキストメニュー要件）
- **前提条件**: 
  - TASK-005が完了していること
- **完了条件**: 
  - Explorer上のファイルを右クリックした際に「Inlined Copy」が表示される
  - 選択時に指定ファイルの内容が展開されてコピーされる
- **注意点**: 
  - Markdownファイルでのみ表示されるよう適切な条件設定
  - ユーザーにとって自然な配置と分かりやすいラベル

### TASK-008: 設定項目の追加と管理機能実装（推定：6時間）

- **概要**: 拡張機能の挙動を制御する設定項目を追加し、その値に応じた動作変更を実装
- **成果物**: 
  - 設定スキーマ定義
  - 設定値読み取りと適用モジュール
- **参照ドキュメント**: 
  - VS Code設定API仕様
  - 補足情報（設定項目要件）
- **前提条件**: 
  - TASK-005が完了していること
- **完了条件**: 
  - `inlined-copy.includeHeadingTitle: boolean` (default: false) の設定が実装されている
  - 設定が保存され、次回起動時にも有効
- **注意点**: 
  - 設定項目の説明文は明確で分かりやすいものに
  - デフォルト値はfalse（見出しを含まない）で後方互換性を維持

### TASK-009: 単体テスト開発（推定：8時間）

- **概要**: 各モジュールの単体テストを開発し実行する
- **成果物**: 
  - 見出し検出・抽出処理のテスト
  - ネスト見出しとID参照のテスト
  - 設定項目反映テスト
- **参照ドキュメント**: 
  - Vitestテストフレームワーク資料
  - DEVELOP.md（テスト関連部分）
- **前提条件**: 
  - TASK-006、TASK-007、TASK-008が完了していること
- **完了条件**: 
  - 全テストケースが成功する
  - エッジケースも含めて十分なカバレッジを達成
- **注意点**: 
  - VS Code APIに依存する部分のモック化
  - 様々なMarkdownパターンでの入出力検証

### TASK-010: 統合テストの実施（推定：9時間）

- **概要**: 拡張機能全体の統合テストを実施する
- **成果物**: 
  - エンドツーエンドテストスイート
  - パフォーマンステスト結果
- **参照ドキュメント**: 
  - VS Code拡張機能テスト関連ドキュメント
- **前提条件**: 
  - TASK-009が完了していること
- **完了条件**: 
  - すべてのユースケースが正常に動作する
  - パフォーマンスが許容範囲内
  - エッジケースでも正しく動作する
- **注意点**: 
  - 大規模Markdownファイルでのパフォーマンス検証
  - 複雑なネスト構造や循環参照の挙動確認

### TASK-011: ドキュメント作成とリリース準備（推定：6時間）

- **概要**: ユーザー向けドキュメントを作成し、機能の使い方や設定項目を説明する。リリースに向けた準備を行う。
- **成果物**: 
  - 更新されたREADME.md
  - 機能説明とサンプル
  - 設定項目の詳細説明
  - リリースノートとCHANGELOG.mdの更新
- **参照ドキュメント**: 
  - 既存のREADME.md
  - VS Code拡張のリリースガイドライン
- **前提条件**: 
  - TASK-010が完了していること
- **完了条件**: 
  - 新機能の使い方が明確に説明されている
  - 設定項目と効果が分かりやすく記載されている
  - スクリーンショットや例が適切に用意されている
  - CHANGELOG.mdがVSCode拡張標準形式で更新されている
- **注意点**: 
  - 初心者にも理解しやすい説明
  - 各種パターンと具体的な使用例の提示
  - バージョン番号の適切な更新




### Ver 3: {{パラメータ}} 入力機能の拡張

- [x] 基本的なパラメータ処理
- [ ] 複数パラメータの連続処理の最適化
- [ ] 未入力時はそのまま出力
- [ ] パラメータ入力UIの改善
- [ ] デフォルト値のサポート

### Ver 4: 参照タグの補完機能

- [ ] ファイル名補完機能
- [ ] 見出し名補完機能
- [ ] 設定オプションの追加

### Ver 5: {{パラメータ=デフォルト値}} 入力'

### Ver 6: {{パラメータ}} 入力 (JSON)

### Ver 7: Markdownプレビュー統合
