# Devin向け指示文策定依頼

以下の3つの情報が後述されます：

- **タスク内容**
- **プロジェクト基本情報**
- **タスク固有の補足情報**

これらを踏まえて、**Devin(Claude sonnet 3.7)** に実行させたい業務の指示文（**「計画策定依頼」**） を.md形式で作成してください。

## 【依頼概要】

本依頼の目的は、Devinが **1指示文につき10ACU（約10時間）以内**で完了できる範囲を正しく認識し、 **「実行するための指示文（計画）」** を策定することです。

## 【指示書の要件】

### 1. ジュニアエンジニア(Devin)が理解可能な具体的な手順書

- コード修正箇所の例示 (ファイル名・関数名など) や、実装のヒントを含めてもOK。
- ただし不必要に冗長な説明は避け、**最小限かつ十分な情報**を盛り込む。
- 成果物・制約・完了の条件は明確に記載する。
- 「プロジェクト基本情報」に記載されているドキュメント目次から手順ごとに参照すべきドキュメントを明示する。
- 作業遂行後、ドキュメントを更新するタスクも明示する。

### 2. 10ACU(10時間)以内の1指示文で完了できるよう範囲を限定

- タスクが大きく、10ACUで終わらないと推測される場合は、指示文の分割を提案してください。

### 3. 成果物の定義と提出先の明示

- 例: 「ブランチ名には タスクを識別する英単語 を含め、完了後にGitHubへプルリクを作成」
- 作成すべき成果物を明記すること
- テスト実行や E2E チェックなど、完了判定ができる基準を明文化する。

### 4. プロジェクトのルール遵守

- 「プロジェクト基本情報」に記載された各種ドキュメントの規約を守る。
- 「タスク固有の補足情報」で指定された要件や状況、制約を必ず考慮する。

### 5. 依存関係や前提タスクの順序

- 手順のうち、並行実行が可能なものと、順次実行が必須なものを明記する。
- 事前に人間が行う前提タスクがあれば、明記する。（アカウントの作成等）

### 6. AIエージェントがつまずきそうな箇所への補足・対策

- 環境変数の設定、認証情報の管理、ライブラリのバージョン、既存コードの取り扱いなど。
- 効率的にタスクを実施するためのアドバイス
- 実装中に遭遇する可能性が高い問題と解決法
- 3度施行しても同じ問題が解決できない場合は、いったん作業を中断して問題を相談する

### 7. タスク実施後のフォローアップ

#### ドキュメントの更新

- 「プロジェクト基本情報」のドキュメント目次から適切に選別し、タスクに伴い、更新する必要があるものを明記する。

#### コミット

- コミットルールに基づき、型チェックやLint、unitテスト実施後コミット

#### PRに追記

- 作業の概要
- タスク毎に見積もりと実際ACUs(そのタスクに関連するAUCの合計値)の比較表
- タスク毎に発生した想定外の問題と対策（今後の頻繁に必要な対策と考えられる場合は、適切なドキュメントへの追加を提案）
- プロダクトや技術負債に関する改善点（あれば）
- 重大なリスクがある項目（セキュリティ・パフォーマンス・UX等）（あれば）

## 【出力例のイメージ】

````markdown
# [タスクID] XXX 機能の実装計画

## 1. タスク概要

- この機能はユーザの○○を保存し、Supabase上で管理する。

## 2. 前提情報

- 「プロジェクト基本情報」：コーディング規約は ESLint + Prettier
- 「タスク固有の補足情報」：RLS (Row Level Security) を有効にする必要あり

## 3. 実装手順

### 3.1. Supabase の items テーブルへ カラム xxx を追加 (1時間)

- 参照: `[[05_database]]` テーブルの定義
- SQL例:
  ```sql
  ALTER TABLE items ADD COLUMN xxx TEXT;
  ```
````

### 3.2. Next.js で /items/[id] ページの API を拡張 (2時間)

- 参照: `[[04_api]]` 現在のAPIの把握
- 実装内容:
  - GET, POST, PUT メソッドの追加
  - バリデーション処理の実装

### 3.3. フロントエンドフォームのUI修正 (1時間)

- 対象ファイル: `components/ItemForm.tsx`
- 参照:
  - `[[32_component_rule]]` コンポーネント作成ルール（要遵守）
  - `[[17_design]]` UI/UXデザイン（要遵守）

### 3.4. テスト実施 (2時間)

- 参照: `[[12_testing]]` テストの作成・実施
- 単体テスト: 新規APIエンドポイントのテスト追加
- E2Eテスト: フォーム送信からデータ保存までの一連の流れを確認

### 3.5. ドキュメント更新 (1時間)

- 手順:
  - `[[03_component_list]]` に作成したコンポーネントの情報を追加
  - `[[05_database]]` にデータベース定義の変更を反映
  - `[[04_api]]` に新規APIエンドポイントの仕様を追記

### 3.6. コミット・PRの作成 (1時間)

- 実施内容:
  - 型チェック・Lintの実行
  - ユニットテスト全体の実行確認
  - PR作成時に下記の追記事項を含める

## 4. 成果物・完了条件

- ブランチ名: `feature/items-crud-enhance`
- PR作成先: GitHub main ブランチ
- 完了条件:
  - LighthouseスコアがAA水準を満たすこと
  - コントラスト比要件を満たすこと
  - すべてのテストがパスすること

## 5. 注意事項

- RLSポリシー設定ファイル： `.supabase/config/rls.sql`
- masterブランチからブランチを作成して作業すること
- Supabaseの変更はマイグレーションファイルとして保存すること

## 6. 想定される問題と対策

- Supabaseのスキーマ変更後にローカル環境と同期できない場合:
  → `npx supabase db reset` を実行して再同期

- Next.js APIエンドポイントでのタイプエラー:
  → zod スキーマを使用して型安全性を確保

## 7. PR追記事項

- 作業概要: このPRではユーザー情報保存機能の実装を行いました
- 見積もり vs 実績:
  | ステップ | 見積もり(時間) | 実績(ACUs) |
  |---------|--------------|-----------|
  | DB変更 | 1.0 | 0.8 |
  | API実装 | 2.0 | 2.5 |
  | UI修正 | 1.0 | 1.2 |
  | テスト | 2.0 | 1.5 |
  | 合計 | 8.0 | 7.0 |
- 想定外の問題: テーブル変更後のマイグレーションで型定義の更新が必要でした
- 技術負債: API入力バリデーションの共通化が今後必要です
- リスク: なし

```

## プロジェクト基本情報

```

![[README.md]]

```

## タスク固有の補足情報

```
実施手順案
- Markdownパーサーの実装または導入（見出しの検出と階層構造の把握）
- 見出しセクションの範囲抽出ロジックの実装（開始見出しから次の同レベル見出しまで）
- 複数の見出しレベル（#, ##, ###など）のサポート
- 見出しが存在しない場合は置換しない。トースト内に存在しなかった一覧を表示
- テストケースの追加（単体テスト、統合テスト）
- READMEへの使用例の追加

現在のタスク状況
![[tasks.md]]

```

## タスク内容

```
見出しセクション抽出機能の実装
![[ファイル名#見出し名]] で指定されたセクションを抽出。見出し名自体は不要


```
